---
title: "Self-Hosted GPU Container"
description: "Deploy GPU avatar workers on your infrastructure with full control over scaling, costs, and data privacy."
icon: "gpu-card"
---

<Info>
**Preview Feature** — 2 credits per minute while using the GPU container.
</Info>

## Overview

The self-hosted GPU avatar container (`docker.io/sgubithuman/expression-avatar:latest`) enables production-grade avatar generation on your own GPU infrastructure.

- **Full Control** — Complete control over deployment, scaling, and configuration
- **Cost Optimization** — Pay only for the GPU resources you use
- **Data Privacy** — Avatar images and audio never leave your infrastructure
- **Customization** — Extend the worker with custom logic and integrations

---

## Quick Start

```bash
# Pull the latest image
docker pull docker.io/sgubithuman/expression-avatar:latest

# Run with GPU support
docker run --gpus all -p 8089:8089 \
    -v /path/to/model-storage:/data/models \
    -e BITHUMAN_API_SECRET=sk_bh_... \
    docker.io/sgubithuman/expression-avatar:latest
```

```bash
# Health check
curl http://localhost:8089/health
# Returns: {"status": "healthy", "service": "expression-avatar", "active_sessions": 0, ...}
```

---

## Environment Variables

### BITHUMAN_API_SECRET (Required)

Your bitHuman API secret for billing. Each active avatar session is billed at **2 credits/minute**.

```bash
-e BITHUMAN_API_SECRET=sk_bh_...
```

Get your API secret from the [bitHuman Console](https://www.bithuman.ai).

<Warning>
Without `BITHUMAN_API_SECRET`, avatar sessions will run but usage will not be tracked or billed. This is not permitted for production use.
</Warning>

### Model Storage (Required)

The container downloads model weights (~2-3 GB) on first startup. Mount a persistent directory to avoid re-downloading on restart:

```bash
-v /path/to/model-storage:/data/models
```

Models are stored at `/data/models` inside the container (the default). No extra env var needed — just mount your directory there.

### How It Works

```
┌─────────────────────────────────────────────────────────────┐
│                    Avatar Generation Flow                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. Container Startup                                       │
│     └─ Load models from /data/models (~30-48s, one-time)   │
│                                                             │
│  2. Avatar Request                                          │
│     └─ avatar_image=<custom image>                          │
│        ├─ Encode image using local models (~2s)             │
│        └─ Generate frames at ~25 FPS                        │
│           → NO cloud calls (100% local GPU)                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Performance Characteristics

| Configuration | Time to First Frame | Description |
|---------------|---------------------|-------------|
| Long-running + Preset | ~4 seconds | Avatar images pre-processed, minimal GPU init |
| Long-running + No Cache | ~6 seconds | Avatar processing on first request |
| Cold Start | ~30-40 seconds | Full avatar engine initialization |

### Long-Running Containers (Recommended)

Containers stay running and handle multiple requests.

- Avatar engine initialized at startup (~30s one-time)
- With presets: first frame in ~4s
- Without presets: first frame in ~6s
- Subsequent frames at ~25 FPS

### Cold Start Containers

Each request gets a fresh container.

- ~30s initialization time per container
- Higher latency per request, lower idle costs
- No persistent state between requests

---

## Troubleshooting

| Problem | Solution |
|---------|----------|
| Container won't start | Check GPU: `nvidia-smi`, verify model volume mount, check logs: `docker logs <id>` |
| High first frame latency | Use long-running containers (avoid cold starts) |
| Out of memory | Use a GPU with ≥8 GB VRAM; the model requires ~5-6 GB |
| Billing not working | Verify `BITHUMAN_API_SECRET` is set correctly; check logs for `[HEARTBEAT]` messages |

---

## Next Steps

<CardGroup cols={2}>
  <Card title="Docker Example" icon="docker" href="https://github.com/bithuman-product/examples/tree/main/public-docker-example">
    Full GPU integration setup
  </Card>
  <Card title="LiveKit Agents" icon="book" href="https://docs.livekit.io/agents">
    LiveKit Agents documentation
  </Card>
</CardGroup>
